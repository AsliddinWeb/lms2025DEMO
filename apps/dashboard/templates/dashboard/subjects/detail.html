
{% extends 'components/base.html' %}
{% load static %}
{% load filesize %}

{% block styles %}
        <!-- dragula css-->
        <link rel="stylesheet" href="{% static 'assets/libs/dragula/dragula.min.css'%}">

{% endblock %}

{% block content %}

                    <!-- Start::page-header -->
                    <div class="page-header-breadcrumb mb-3">
                        <div class="d-flex align-center justify-content-between flex-wrap">
                            <h1 class="page-title fw-medium fs-18 mb-0">{{ subject.subject.name }}</h1>
                            <ol class="breadcrumb mb-0">
                                <li class="breadcrumb-item"><a href="javascript:void(0);">XIU Onlayn</a></li>
                                <li class="breadcrumb-item"><a href="javascript:void(0);">Fanlar</a></li>
                                <li class="breadcrumb-item active" aria-current="page">{{ subject.subject.name }}</li>
                            </ol>
                        </div>
                    </div>
                    <!-- End::page-header -->

                    <!-- Start::row-1 -->
                    <div class="row">
                        <div class="col">
                            <div class="card custom-card">
                                <div class="card-header justify-content-between">
                                    <div class="card-title">
                                        Fan ma'lumotlari
                                    </div> 
                                    <div class="btn-list">
                                        <a href="{% url 'dashboard:subjects_list' %}" class="btn btn-sm btn-primary btn-wave">
                                            <i class="ri-arrow-left-line align-middle me-1 fw-medium"></i>Fanlarga qaytish
                                        </a>

                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="d-flex align-items-center mb-4 gap-2 flex-wrap">
                                        <div class="lh-1">
                                            <span class="avatar avatar-lg me-1 bg-primary"><i class="ri-stack-line fs-24 lh-1"></i></span>
                                        </div>
                                        <div>
                                            <h6 class="fw-medium mb-2">
                                                {{ subject.subject.name }}
                                            </h6>
                                            <span class="badge bg-success-transparent"> {{ subject.subjectType.name }}</span>
                                            <span class="text-muted fs-12"><i class="ri-circle-fill text-success mx-2 fs-9"></i>Fan kodi: {{ subject.subject.code }}</span>
                                        </div>
                                    </div>

                                    <div class="d-flex gap-5 my-4 flex-wrap">
                                    <!-- Fan krediti -->
                                    <div class="d-flex align-items-center gap-2 me-3">
                                        <span class="avatar avatar-md avatar-rounded me-1 bg-success">
                                            <i class="ri-book-open-line fs-18 lh-1 align-middle"></i>
                                        </span>
                                        <div>
                                            <div class="fw-medium mb-0">
                                                Fan Krediti
                                            </div>
                                            <span class="fs-12 text-muted">{{ subject.credit }} kredit</span>
                                        </div>
                                    </div>

                                    <!-- Resurslar soni -->
                                    <div class="d-flex align-items-center gap-2 me-3">
                                        <span class="avatar avatar-md avatar-rounded me-1 bg-info">
                                            <i class="ri-folder-line fs-18 lh-1 align-middle"></i>
                                        </span>
                                        <div>
                                            <div class="fw-medium mb-0">
                                                Resurslar Soni
                                            </div>
                                            <span class="fs-12 text-muted">{{ subject.resources_count }} ta</span>
                                        </div>
                                    </div>

                                    <!-- Topshiriqlar soni -->
                                    <div class="d-flex align-items-center gap-2">
                                        <span class="avatar avatar-md avatar-rounded me-1 bg-warning">
                                            <i class="ri-task-line fs-18 lh-1 align-middle"></i>
                                        </span>
                                        
                                        <div>
                                            <span class="d-block fs-14 fw-medium">Topshiriqlar Soni</span>
                                            <span class="fs-12 text-muted">{{ subject.tasks_count }} ta</span>
                                        </div>
                                    </div>
                                </div>


                                    <div class="fs-15 fw-medium mb-2">Topshiriqlar Raqamlarda :</div>
                                    <div class="d-flex gap-2 flex-wrap">
                                        <span class="badge bg-primary-transparent">Jami topshiriqlar: {{ subject.tasks_count }} ta</span>
                                        <span class="badge bg-info-transparent">Yuborilgan: {{ subject.submits_count }} ta</span>
                                        <span class="badge bg-success-transparent">Baholangan: {{ subject.marked_count }} ta</span>
                                        <span class="badge bg-danger-transparent">Qaytarilgan: {{ subject.absent_count }} ta</span>
                                    </div>
                                </div>
                                                          
                            </div>  
                            
                            <div class="card custom-card overflow-hidden">
    <div class="card-header justify-content-between">
        <div class="card-title">
            Fan Resurslari
        </div>
    </div>
    <div class="card-body p-0">
        <div class="tab-pane border-0 p-0" id="faq1" role="tabpanel">
            <div class="accordion faq-accordion accordions-items-seperate" id="accordionFAQ1">
                {% for resource in subject_resources %}
                <div class="accordion-item">
                    <!-- Accordion Header -->
                    <h2 class="accordion-header" id="resource_{{ resource.id }}">
                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" 
                                type="button" 
                                data-bs-toggle="collapse"
                                data-bs-target="#collapse_resource_{{ resource.id }}" 
                                aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}"
                                aria-controls="collapse_resource_{{ resource.id }}">
                            <span class="avatar avatar-md avatar-rounded p-2 bg-light lh-1 me-2">
                                <img src="{% static 'assets/images/media/file-manager/1.png'%}" alt="">
                            </span>
                            <div>
                                <span class="fw-semibold d-block">{{ forloop.counter }}. {{ resource.title }}</span>
                                <small class="text-muted">
                                    <i class="ri-book-2-line me-1 text-primary"></i>{{ resource.trainingType.name }} |
                                    <i class="ri-user-line me-1 text-success"></i>{{ resource.employee.name }}
                                </small>
                            </div>
                        </button>
                    </h2>

                    <!-- Accordion Body -->
                    <div id="collapse_resource_{{ resource.id }}" 
                         class="accordion-collapse collapse {% if forloop.first %}show{% endif %}"
                         aria-labelledby="resource_{{ resource.id }}"
                         data-bs-parent="#accordionFAQ1">
                        <div class="accordion-body">

                            {% for subject_file in resource.subjectFileResourceItems %}
                            <div class="card border mb-3">
                                <div class="card-body p-3">
                                    <!-- Resource type + link -->
                                    <div class="d-flex align-items-center justify-content-between mb-2">
                                        <span class="fw-semibold">
                                            <i class="ri-folder-2-line text-warning me-1"></i>
                                            {{ subject_file.resourceType.name }}
                                        </span>
                                        {% if subject_file.url %}
                                            <a href="{{ subject_file.url }}" target="_blank" class="btn btn-sm btn-primary-light">
                                                <i class="ri-external-link-line"></i> Tashqi havola
                                            </a>
                                        {% endif %}
                                    </div>

                                    {% if subject_file.comment %}
                                    <p class="text-muted small mb-2">
                                        <i class="ri-chat-1-line me-1 text-info"></i>
                                        {{ subject_file.comment }}
                                    </p>
                                    {% endif %}

                                    <!-- Files List -->
                                    {% if subject_file.files %}
                                    <div class="fw-semibold mb-2">
                                        <i class="ri-file-list-3-line text-secondary me-1"></i> Fayllar:
                                    </div>
                                    <ul class="list-group list-group-flush">
                                        {% for file in subject_file.files %}
                                        <li class="list-group-item d-flex align-items-center justify-content-between">
                                            <div>
                                                <i class="ri-file-3-line text-primary me-2"></i> 
                                                <span class="fw-medium">{{ file.name }}</span>
                                                <small class="text-muted">({{ file.size|filesize_mb }})</small>
                                            </div>
                                            <a href="{{ file.url }}" target="_blank" class="btn btn-sm btn-success">
                                                <i class="ri-download-line"></i> Yuklab olish
                                            </a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}

                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

                        </div>
                        
                    </div>
                    <!--End::row-1 -->

{% endblock %}

{% block scripts %}
  <!-- Dragula JS -->
  <script src="{% static 'assets/libs/dragula/dragula.min.js'%}"></script>

  <!-- Internal Project Overview Dashboard -->
  <script src="{% static 'assets/js/project-overview.js'%}"></script>



{% endblock %}

